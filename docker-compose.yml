version: '3.7'

services:

  web-api:
    build:  
      context: ./flask
    secrets:
      - source: postgres-connection
        target: /usr/app/secrets.json
    networks:
      - default-bridge


  web-front:
    build:
      context: ./next
    volumes:
      - /usr/app/node_modules
      - ./next:/usr/app
    environment:
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - web-api
    networks:
      - default-bridge

secrets:
  postgres-connection:
    file: ./configs/postgres/secrets.json

networks:
  default-bridge:
    ipam:
      driver: default
      config:
        - subnet: 172.16.5.0/20
